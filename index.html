<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Heatmap</title>    
<link rel="stylesheet" type="text/css" href="css/main.css">
<link rel="stylesheet" href="css/bootstrap.min.css">
</head>   
<body>    
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.csv.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=false&libraries=visualization"></script>
    <script>
  $(document).ready(function() {
    if(isAPIAvailable()) {
      $('#files').bind('change', handleFileSelect);
    }
	$( "#t" ).click(function() {
console.log("inside initialize")
  //alert( "Handler for .click() called." );

});
});

function isAPIAvailable() {
    // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      // Great success! All the File APIs are supported.
      return true;
    } else {
      // source: File API availability - http://caniuse.com/#feat=fileapi
      // source: <output> availability - http://html5doctor.com/the-output-element/
      document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
      // 6.0 File API & 13.0 <output>
      document.writeln(' - Google Chrome: 13.0 or later<br />');
      // 3.6 File API & 6.0 <output>
      document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
      // 10.0 File API & 10.0 <output>
      document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
      // ? File API & 5.1 <output>
      document.writeln(' - Safari: Not supported<br />');
      // ? File API & 9.2 <output>
      document.writeln(' - Opera: Not supported');
      return false;
    }
  }

  function handleFileSelect(evt) {
      var class1= new String("Political Violence Communal Clash Cultism Electoral Violence Terrorism Sectarian Violence Political Violence Communal Clash Cultism Electoral Violence Terrorism clashe communal Clash Manslaugherr manslaughter Manslaughter Militancy Militants political violence Political Violence Political Threath political violence Suscide Terrorism Scare Sect Suspects Sectarian Violence");
var class2=new String("Murder murder Clash/Murder Kidnapping/Murder Muder Murdeer MURDER Murder Suspicion Homicide Cultism clash Stabbing Car Accident");
var class3=new String("Robbery Kidnapping kidnapping Child Trafficking stealing Stealing Armed Robbers baby stealing bus theft Child Smuggling child abuse theft Thieves Robber Suspect Robbery Suspects Robbbery Scare Kidnappers Kidnappers Arrested Kidnapping Suspects Pastor Kidnapping Victim");
var class4=new String("Armed Robbery Arm Smuggling Arms Smuggling Drug Drug trafficking Drug Drug Carrier Drug/Cannabis Drugs Fake Drug fake cheque Forgery fraudsters Immigration Impersonation IMPERSONATION election malpractice electoral malpractice Electoral Malpractice Electoralmalpractices Post Electoral Malpractice Fraud fraud corruption Plot Air Accident Prevented");
    var files = evt.target.files; // FileList object
    var file = files[0];

    // read the file contents

    var reader = new FileReader();
    reader.readAsText(file);
    reader.onload = function(event){
    var csv = event.target.result;
    var data = $.csv.toArrays(csv);
    var intr;
    var m=[];	
for(var row in data) {
if( data[row][6].trim().length>0 && data[row][7].trim().length>0 && ($.isNumeric(data[row][6])) && ($.isNumeric(data[row][7])) &&  row!=data.length-1 )
  {
   if (class1.indexOf(data[row][8])>-1)
   {
   intr = {location:new google.maps.LatLng(data[row][6],data[row][7]),weight:5};
   m.push(intr);
   }
   else if (class2.indexOf(data[row][8])>-1){
   intr = {location:new google.maps.LatLng(data[row][6],data[row][7]),weight:4};
   m.push(intr);
   }
   else if(class3.indexOf(data[row][8])>-1){
   intr = {location:new google.maps.LatLng(data[row][6],data[row][7]),weight:3};
   m.push(intr);
	}
	else if(class4.indexOf(data[row][8])>-1){
	intr = {location:new google.maps.LatLng(data[row][6],data[row][7]),weight:2};
   m.push(intr);
	}
	else
	{
	intr = {location:new google.maps.LatLng(data[row][6],data[row][7]),weight:0.8};
   m.push(intr);
	}
  }
  }
initialize(m);
    };
    reader.onerror = function(){ alert('Unable to read ' + file.fileName); };
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////

function initialize(m) {
   
  var mapOptions = {
    zoom: 6,
    center: new google.maps.LatLng(9.0667, 7.4833),
    mapTypeControl: false,
    draggable: false,
    scaleControl: false,
    scrollwheel: false,
    navigationControl: false,
    streetViewControl: false,
    disableDefaultUI: true,
    disableDoubleClickZoom: true,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
	  
var pointArray = new google.maps.MVCArray(m);
  heatmap = new google.maps.visualization.HeatmapLayer({
    data: pointArray
  });

  heatmap.setMap(map);
   heatmap.set('radius', heatmap.get('radius') ? null : 20);
}  
</script>
<div class="container">
  <div class="row">
 <h4>Visualise</h4>
            <span class="file-input btn btn-block btn-primary btn-file">
                Browse <input type="file" id=files name=files[] multiple>
            </span>
       <div id="map-canvas" style="width: auto; height: 700px; margin:0 auto;" ></div>      
  </div>
</div>
</body>
</html>